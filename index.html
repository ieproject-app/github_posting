import React, { useState } from "react";

// Emoji rekomendasi untuk topik umum, bisa diupgrade sesuai kebutuhan
const emojiMap = {
  Pendahuluan: "📚",
  Subjudul1: "💡",
  Subjudul2: "🛠️",
  Subjudul3: "🖼️",
  Kesimpulan: "✅",
  default: "✍️"
};

// Utility untuk slug judul
function slugify(text: string) {
  return text
    .toLowerCase()
    .replace(/[^\w\s-]/g, "")
    .replace(/\s+/g, "-")
    .replace(/-+/g, "-");
}

// Utility tanggal
function getDateStr() {
  const tzOffset = 7 * 60 * 60 * 1000; // +0700
  const d = new Date(Date.now() + tzOffset);
  const pad = (n: number) => n.toString().padStart(2, "0");
  return (
    `${d.getUTCFullYear()}-${pad(d.getUTCMonth() + 1)}-${pad(d.getUTCDate())}` +
    ` ${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}:${pad(d.getUTCSeconds())} +0700`
  );
}

type FormState = {
  judul: string;
  kategori: string[];
  penulis: string;
  deskripsi: string;
  target_pembaca: string;
  poin_kunci: string[];
  bahasa_kode: string;
  nama_file_gambar: string;
  alt_text_gambar: string;
};

const defaultForm: FormState = {
  judul: "",
  kategori: [],
  penulis: "",
  deskripsi: "",
  target_pembaca: "",
  poin_kunci: [],
  bahasa_kode: "",
  nama_file_gambar: "",
  alt_text_gambar: ""
};

function getFileName(judul: string) {
  const date = new Date();
  const yyyy = date.getFullYear();
  const mm = (date.getMonth() + 1).toString().padStart(2, "0");
  const dd = date.getDate().toString().padStart(2, "0");
  const slug = slugify(judul || "judul-postingan");
  return `${yyyy}-${mm}-${dd}-${slug}.md`;
}

function getMarkdown(form: FormState) {
  // Placeholder
  const judul = form.judul || "Judul Postingan";
  const kategori = form.kategori.length
    ? form.kategori.slice(0, 2)
    : ["kategori1", "kategori2"];
  const penulis = form.penulis || "Nama Penulis";
  const deskripsi = form.deskripsi || "Deskripsi singkat untuk SEO.";
  const target_pembaca = form.target_pembaca || "Pemula";
  const poin_kunci =
    form.poin_kunci.length >= 3
      ? form.poin_kunci
      : ["Poin penting 1", "Poin penting 2", "Poin penting 3"];
  const bahasa_kode = form.bahasa_kode || "python";
  const nama_file_gambar = form.nama_file_gambar
    ? form.nama_file_gambar.replace(/\s+/g, "-")
    : "placeholder.jpg";
  const alt_text_gambar = form.alt_text_gambar || "Deskripsi gambar";
  const date = getDateStr();

  // Emoji logic
  const emojiJudul = "📝";
  const emojiPendahuluan = emojiMap["Pendahuluan"];
  const emojiSub1 = emojiMap["Subjudul1"];
  const emojiSub2 = emojiMap["Subjudul2"];
  const emojiSub3 = emojiMap["Subjudul3"];
  const emojiKesimpulan = emojiMap["Kesimpulan"];

  return `---
layout: post
title: "${judul} ${emojiJudul}"
date: ${date}
categories: [${kategori.join(", ")}]
author: ${penulis}
image: /assets/img/${nama_file_gambar}
description: "${deskripsi}"
---

## Pendahuluan ${emojiPendahuluan}

Selamat datang! Artikel ini ditujukan untuk ${target_pembaca}. Pada postingan kali ini kita akan membahas ${judul.toLowerCase()}.

## Poin Penting ${emojiSub1}

${poin_kunci.map((p) => `- ${p}`).join("\n")}

## Contoh Kode ${emojiSub2}

Berikut contoh kode terkait topik ini:

\`\`\`${bahasa_kode}
# Kode contoh di sini
\`\`\`

## Ilustrasi ${emojiSub3}

![${alt_text_gambar}](/assets/img/${nama_file_gambar})

| Kolom 1 | Kolom 2 |
|---------|---------|
| Baris 1 | Data    |
| Baris 2 | Data    |

## Kesimpulan ${emojiKesimpulan}

Demikian pembahasan singkat mengenai ${judul.toLowerCase()}. Semoga bermanfaat!

---

**Apa pendapatmu tentang topik ini? Yuk diskusi di kolom komentar!**

---

_Simpan file di folder_ **_posts/_** _dan upload gambar ke_ **/assets/img/**_


<!--
Tips Otomatis:
- SEO: Pastikan keyword muncul di judul, deskripsi, dan heading.
- Gunakan alt text deskriptif pada gambar.
- Tulis deskripsi 1 kalimat untuk front matter.
- Mobile Friendly: gambar max lebar 1200px, tabel sederhana, bullet points.
- Emoji: tambahkan emoji relevan di judul & subjudul.
- Format nama file: YYYY-MM-DD-judul-dengan-hyphen.md
- Rekomendasi gambar gratis: Unsplash, Pexels, Pixabay.
-->
`;
}

export default function WebToolsGenerator() {
  const [form, setForm] = useState<FormState>(defaultForm);
  const [markdown, setMarkdown] = useState("");
  const [fileName, setFileName] = useState("");

  function handleChange(e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {
    const { name, value } = e.target;
    setForm((prev) => ({
      ...prev,
      [name]: value
    }));
  }

  function handleKategoriChange(e: React.ChangeEvent<HTMLInputElement>) {
    const arr = e.target.value
      .split(",")
      .map((x) => x.trim())
      .filter((x) => !!x);
    setForm((prev) => ({
      ...prev,
      kategori: arr
    }));
  }

  function handlePoinChange(e: React.ChangeEvent<HTMLTextAreaElement>) {
    const arr = e.target.value
      .split("\n")
      .map((x) => x.trim())
      .filter((x) => !!x);
    setForm((prev) => ({
      ...prev,
      poin_kunci: arr
    }));
  }

  function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    const md = getMarkdown(form);
    setMarkdown(md);
    setFileName(getFileName(form.judul));
  }

  return (
    <div style={{ maxWidth: 700, margin: "2rem auto", fontFamily: "sans-serif" }}>
      <h2>Web Tools: Jekyll Post Generator 🚀</h2>
      <form onSubmit={handleSubmit} style={{ background: "#f9f9f9", padding: 20, borderRadius: 8 }}>
        <label>
          Judul postingan*<br />
          <input name="judul" value={form.judul} onChange={handleChange} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Kategori utama (maks 2, pisahkan koma)*<br />
          <input name="kategori" value={form.kategori.join(", ")} onChange={handleKategoriChange} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Nama penulis*<br />
          <input name="penulis" value={form.penulis} onChange={handleChange} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Deskripsi singkat (SEO, 1 kalimat)*<br />
          <input name="deskripsi" value={form.deskripsi} onChange={handleChange} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Target pembaca<br />
          <input name="target_pembaca" value={form.target_pembaca} onChange={handleChange} style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Poin-poin kunci (minimal 3, 1 baris per poin)*<br />
          <textarea name="poin_kunci" value={form.poin_kunci.join("\n")} onChange={handlePoinChange} rows={3} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Bahasa pemrograman untuk blok kode (python, html, js, dll)*<br />
          <input name="bahasa_kode" value={form.bahasa_kode} onChange={handleChange} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Nama file gambar (opsional, contoh: gambar.jpg)<br />
          <input name="nama_file_gambar" value={form.nama_file_gambar} onChange={handleChange} style={{ width: "100%" }} />
        </label>
        <br /><br />
        <label>
          Alt text gambar (SEO, aksesibilitas)*<br />
          <input name="alt_text_gambar" value={form.alt_text_gambar} onChange={handleChange} required style={{ width: "100%" }} />
        </label>
        <br /><br />
        <button type="submit" style={{ padding: "8px 24px", fontWeight: "bold" }}>
          Generate Markdown
        </button>
      </form>

      {markdown && (
        <>
          <h3>Hasil File Markdown:</h3>
          <div style={{ background: "#222", color: "#eee", padding: 10, borderRadius: 5, marginTop: 20 }}>
            <div style={{ fontSize: "0.95em", marginBottom: 5 }}>
              <b>Nama file:</b> <code>{fileName}</code>
            </div>
            <pre style={{ whiteSpace: "pre-wrap", overflowX: "auto" }}>
              {``
                + "```markdown name=" + fileName + "\n"
                + markdown
                + "```"
              }
            </pre>
          </div>
          <div style={{ marginTop: 20, fontSize: "0.95em", color: "#555" }}>
            <b>Tips Otomatis:</b>
            <ul>
              <li>SEO: Pastikan keyword muncul di judul, deskripsi, dan heading.</li>
              <li>Gunakan alt text deskriptif pada gambar.</li>
              <li>Tulis deskripsi 1 kalimat untuk front matter.</li>
              <li>Mobile Friendly: gambar max lebar 1200px, tabel sederhana, bullet points.</li>
              <li>Emoji: tambahkan emoji relevan di judul & subjudul.</li>
              <li>Format nama file: <i>YYYY-MM-DD-judul-dengan-hyphen.md</i></li>
              <li>Rekomendasi gambar gratis: <a href="https://unsplash.com/">Unsplash</a>, <a href="https://www.pexels.com/">Pexels</a>, <a href="https://pixabay.com/">Pixabay</a></li>
            </ul>
          </div>
        </>
      )}
    </div>
  );
}
